# Control Log

## [2026-01-04] Исправление физики поворота

- Переработана модель бокового скольжения в `CarPhysics.js`: теперь `steerAngle` корректно влияет на `slipSideFront`.
- Улучшена отзывчивость: уменьшен момент инерции и увеличены силы тяги/торможения в `config.js`.
- Машина теперь адекватно реагирует на повороты и может уходить в дрифт при использовании ручного тормоза.

## [2026-01-04] Исправление ошибки TypeError в Car.js

- Добавлен отсутствующий метод `drawSteerableWheel` в класс `Car`, что предотвращает падение рендеринга.
- Исправлена ошибка `TypeError: this.drawSteerableWheel is not a function`, которая приводила к черному экрану.

## [2026-01-04] Исправление черного экрана (GitHub Pages)

- Исправлена критическая ошибка в `src/config.js`: добавлены недостающие импорты для сцен `Boot` и `Game`.
- Оптимизирован `index.html`: удалено дублирующее подключение библиотеки Phaser (оставлен полный билд).
- Теперь игра должна корректно инициализироваться при загрузке.

- **2026-01-04**: Реализована система Storage (`src/storage/Storage.js`).
  - Сохранение/загрузка лучшего времени круга (`bestLapTime`).
  - Сохранение/загрузка параметров физики из `config.js`.
  - Интеграция в `config.js` и `Game.js`.

1. [x] Добавлены следы резины: используются `RenderTexture` (отрисовка при `v_side > 2.5`).
2. [x] Добавлен ретро-эффект: `tileSprite` с шумом поверх сцены.
3. [x] Обновлен `Car.js`: добавлен расчет глобальных координат колес.

## [2026-01-04] Реализация трассы и системы кругов

- Создан класс `Track` с физическими стенами и чекпоинтами (сенсорами).
- В `Game.js` реализована логика кругов: старт, отсечка круга, проверка прохождения всех чекпоинтов.
- Добавлена обработка столкновений со стенами (тряска камеры).
- Обновлен HUD: добавлено отображение текущего круга, времени круга и лучшего времени.
- Машина теперь спавнится в стартовой позиции перед финишной чертой.

## [2026-01-04] Улучшение камеры и расширение мира

- Реализована камера с плавным следованием (lerp) и опережением (look ahead) по вектору скорости.
- Размер мира увеличен до 4000x4000.
- Добавлен тайловый фон с сеткой для визуализации движения.
- `Car.js`: Исправлена отрисовка, машина теперь всегда крупная и четкая.
- `CarPhysics.js`: Настроены коэффициенты для более приятного управления на больших пространствах.

## [2026-01-04] - Инициализация проекта MVP Drift

- Создана базовая структура проекта.
- Подключен Phaser 3 через CDN.
- Настроены ES модули для загрузки сцен.
- Инициализирован физический движок Matter.js.
- Созданы заглушки графики (background, car) в `Boot.js`.
- Реализована обработка ввода (WASD, Space, R) с логированием в консоль.
- Проект готов к деплою на GitHub Pages.

## [2026-01-04] - Добавление сущности Car и систем управления

- Реализована сущность `Car` с Matter physics телом (70x35) и кастомной графикой.
- Добавлен механизм плавного поворота колес (steerAngle) в `Input.js`.
- Создана точка интеграции физики в `CarPhysics.js` (тяга, торможение, ручник).
- Реализован `HUD` с индикатором поворота руля, скоростью и передачей.
- Поддержано управление: WASD/Arrows, Space (ручник), Shift/Ctrl/E/D (передачи), R (сброс).
- Обновлена сцена `Game.js` для интеграции всех новых компонентов.

## [2026-01-04] - Реализация физики дрифта и продвинутого HUD

- Обновлена конфигурация в `config.js` для поддержки детальных физических параметров.
- Внедрена физика RWD (задний привод) в `CarPhysics.js` с расчетом боковых сил и дрифта.
- Реализована модель двигателя с RPM, ограничителем и ручной КПП.
- Уровни сцепления динамически меняются при использовании ручного тормоза.
- Обновлен HUD: добавлен тахометр, спидометр, индикатор передачи и бокового скольжения.
- Синхронизация внутреннего состояния автомобиля с физическим движком Matter.js.
- Обновлен файл `readme.md`.
